<?

$test_id=$_GET[test_id];
//проверка, не пытаются ли нас хакнуть
if ( preg_match("/[^(\d)]/",$test_id) ) {
	echo "пошёл нафиг, подлый хакер!";
	exit(); }


//проверка, если тест в базе
$result_check_test=mysql_db_query($mysql_dbname,"
select * from tests where test_id=$test_id ");
if(mysql_num_rows($result_check_test)==0) 
{echo $yaz['tstudio']['no_such_test'][$lang];
 exit();}


if($fetched_access[permission_owner]==1) {
$result_test=mysql_db_query($mysql_dbname,"select * from tests where test_id='$test_id'"); }
else {
$result_test=mysql_db_query($mysql_dbname,"
select permissions.*,tests.* from permissions,tests
where 	permissions.user_id='$_SESSION[user_id]' and 
	permissions.group_id='$_SESSION[group_id]' and
	permissions.object_code=1 and
	permissions.object_id=tests.test_id and
	tests.test_id='$test_id'
");
//проверка, есть ли у юзера доступ к этой зоне
if(mysql_num_rows($result_test)==0) 
	{
	echo $yaz['tstudio']['zone_anavail'][$lang];
	exit();
	}
  }



include("./xml_scripts/import_xml_functions.php");


$uploaddir='./xmls/';
if (move_uploaded_file($_FILES['topic_xml_file']['tmp_name'],$uploaddir."temp_topic_xml.xml")) 
{                                              
    echo $yaz['tstudio']['xml_file_received'][$lang]."<br>";
    if ($_FILES['topic_xml_file']['type']!='text/xml') 
    {echo $yaz['tstudio']['xml_file_not_xml'][$lang];}
    else
        {
        //показуем содержимое XML-файла
        //если $_POST[insert]=1 - надо вставить данные в базу
        if ($_POST[insert]==1)
            {
            echo $yaz['tstudio']['xml_writing_to_db'][$lang]."<br>";
            import_xml("temp_topic_xml.xml","topics",1,$test_id);
            }
        else 
            {

            import_xml("temp_topic_xml.xml","topics",0,$test_id);
            }
        }
} 
else {
    echo $yaz['tstudio']['xml_upload_error'][$lang].":<br>";
    print_r($_FILES);
}