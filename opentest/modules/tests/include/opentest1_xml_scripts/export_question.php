<?
$test_id=$_GET[test_id];
$topic_id=$_GET[topic_id];
$question_id=$_GET[q_id];
//проверка, не пытаются ли нас хакнуть
if ( preg_match("/[^(\d)]/",$test_id) 
	or preg_match("/[^(\d)]/",$topic_id) 
	or preg_match("/[^(\d)]/",$question_id)) {
	echo "пошёл нафиг, подлый хакер!";
	exit(); }


//проверка, если тема в базе
$result_check_topic=mysql_db_query($mysql_dbname,"
select * from topics where topic_id=$topic_id ");
if(mysql_num_rows($result_check_topic)==0) 
{echo $yaz['tstudio']['no_such_topic'][$lang];
 exit();}


if($fetched_access[permission_owner]==1) {
$result_topic=mysql_db_query($mysql_dbname,"select * from topics where topic_id='$topic_id'"); }
else {
$result_test=mysql_db_query($mysql_dbname,"
select permissions.*,tests.* from permissions,tests
where 	permissions.user_id='$_SESSION[user_id]' and 
	permissions.group_id='$_SESSION[group_id]' and
	permissions.object_code=1 and
	permissions.object_id=tests.test_id and
	tests.test_id='$test_id' and
	permissions.permission_owner=1
");
$result_topic=mysql_db_query($mysql_dbname,"
select permissions.*,topics.* from permissions,topics
where 	permissions.user_id='$_SESSION[user_id]' and 
	permissions.group_id='$_SESSION[group_id]' and
	permissions.object_code=2 and
	permissions.object_id=topics.topic_id and
	topics.topic_id='$topic_id' and
	permissions.permission_owner=1
");


//проверка, есть ли у юзера доступ к этой зоне
if(mysql_num_rows($result_test)==0 and 
		$fetched_access[permission_owner]!=1 and
		mysql_num_rows($result_topic)==0) 
	{
	echo $yaz['tstudio']['zone_anavail'][$lang];
	exit();
	}
  }
//---- конец всех проверок

$fetched_topic=mysql_fetch_array($result_topic);

echo $yaz['tstudio']['xml_exporting_question'][$lang].": <br>";

require_once("./xml_scripts/export_xml_functions.php");

$res_export=export_xml("question",$test_id,$topic_id,$question_id);

$xml_str=$res_export;
$xml_str=encode_xml_string($xml_str,"utf-8","windows-1251");
echo "<br>".$yaz['tstudio']['xml_file_size'][$lang].": $res_export B
	<br><font size=3 class='note'>".$yaz['tstudio']['xml_in_few_secs'][$lang]."</font>";
echo "<pre>".htmlspecialchars($xml_str)."</pre>";

$download=1;