<?
$topic_id=$_GET[topic_id];
//проверка, не пытаются ли нас хакнуть
if ( preg_match("/[^(\d)]/",$test_id) ) {
	echo "пошёл нафиг, подлый хакер!";
	exit(); }

//проверка, если тема в базе
$result_check_topic=mysql_db_query($mysql_dbname,"
select * from topics where topic_id=$topic_id ");
if(mysql_num_rows($result_check_topic)==0) 
{echo $yaz['tstudio']['no_such_topic'][$lang];
 exit();}
//узнаём, в каком тесте находится данная тема
$result_test=mysql_db_query($mysql_dbname,"
select * from tests,topics,permissions
where tests.test_id=topics.test_id and
	tests.test_id=permissions.object_id and
	permissions.object_code=1 and
	permissions.user_id=$_SESSION[user_id] and
	permissions.group_id=$_SESSION[group_id] and
	topics.topic_id=$topic_id ");
$fetched_test=mysql_fetch_array($result_test);

if($fetched_access[permission_owner]==1 
	or $fetched_test[permission_owner]==1) {
$result_topic=mysql_db_query($mysql_dbname,"select * from topics where topic_id='$topic_id'"); }
else {
$result_topic=mysql_db_query($mysql_dbname,"
select permissions.*,topics.* from permissions,topics
where 	permissions.user_id='$_SESSION[user_id]' and 
	permissions.group_id='$_SESSION[group_id]' and
	permissions.object_code=2 and
	permissions.object_id=topics.topic_id and
	topics.topic_id='$topic_id' and
	( permissions.permission_write=1 or permissions.permission_owner=1)
");
//проверка, есть ли у юзера доступ к этой зоне
if(mysql_num_rows($result_topic)==0 or $fetched_test[permission_read]!=1) 
	{
	echo $yaz['tstudio']['zone_anavail'][$lang];
	exit();
	}
  }

include("./xml_scripts/import_xml_functions.php");

$uploaddir='./xmls/';
if (move_uploaded_file($_FILES['question_xml_file']['tmp_name'],$uploaddir."temp_question_xml.xml")) 
{                                              
    echo $yaz['tstudio']['xml_file_received'][$lang]."<br>";
    if ($_FILES['question_xml_file']['type']!='text/xml') 
    {echo $yaz['tstudio']['xml_file_not_xml'][$lang];}
    else
        {
        //показуем содержимое XML-файла
        //если $_POST[insert]=1 - надо вставить данные в базу
        if ($_POST[insert]==1)
            {
            echo $yaz['tstudio']['xml_writing_to_db'][$lang]."<br>";
            import_xml("temp_question_xml.xml","questions",1,'',$topic_id);
            }
        else 
            {

            import_xml("temp_question_xml.xml","questions",0,'',$topic_id);
            }
        }
} 
else {
    echo $yaz['tstudio']['xml_upload_error'][$lang].":<br>";
    print_r($_FILES);
}