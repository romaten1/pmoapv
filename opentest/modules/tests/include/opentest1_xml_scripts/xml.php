<?

if (@!($xml = join('',file('xmls/test1.xml')))) {echo "file error";}
else {
    if (!$dom=domxml_open_mem($xml)) {echo "error while parsing XML";}
    else {
        $root = $dom->document_element();
        switch ($root->tagname()) 
            {
            case 'answers': {echo "this is answers XML<br>";get_answers_from_xml($root,900);break;}
            case 'questions': {echo "this is questions XML<br>";get_questions_from_xml($root,900);break;}
            case 'topics': {echo "this is topic XML<br>";get_topics_from_xml($root,900);break;}
            case 'test': {echo "this is test XML<br>";get_tests_from_xml ($root);break;}
    
            default: {echo "unknown XML";break;}
            }
         }
     }
//-------------------------------

function get_tests_from_xml ($root) {
global $mysql_dbname;

$test_name=$root->get_elements_by_tagname('test_name'); 
$topics=$root->get_elements_by_tagname('topics'); 
$name=$test_name[0];$name_content=$name->get_content();                
$name_content=iconv("ISO-8859-5","windows-1251",$name_content);        
echo "<br><b>test name: $name_content </b>";                           
                                                                     
$result_insert_test=mysql_db_query($mysql_dbname,"           
insert into tests (test_id,test_name,test_disable)
values ('','$name_content',0) ");

get_topics_from_xml($topics[0],mysql_insert_id());

    }

//-------------------------------

function get_topics_from_xml ($root,$test_id) {
global $mysql_dbname;

$topic_nodes=$root->get_elements_by_tagname('topic'); 
foreach($topic_nodes as $topic_node)
    {
$topic_name=$topic_node->get_elements_by_tagname('topic_name'); 
$questions=$topic_node->get_elements_by_tagname('questions'); 
$name=$topic_name[0];$name_content=$name->get_content();
$name_content=iconv("ISO-8859-5","windows-1251",$name_content);
echo "<br><b>topic name: $name_content </b>";

$result_insert_topic=mysql_db_query($mysql_dbname,"
insert into topics (topic_id,topic_name,test_id)
values ('','$name_content','$test_id') ");

get_questions_from_xml($questions[0],mysql_insert_id());

    }
      }

//-------------------------------

function get_questions_from_xml ($root,$topic_id) {
global $mysql_dbname;

$question_nodes=$root->get_elements_by_tagname('question'); 
foreach($question_nodes as $question_node)
    {
$question_type=$question_node->get_elements_by_tagname('question_type'); 
$question_text=$question_node->get_elements_by_tagname('question_text'); 
$answers=$question_node->get_elements_by_tagname('answers'); 
$text=$question_text[0];$text_content=$text->get_content();
$type=$question_type[0];$type_content=$type->get_content();
$text_content=iconv("ISO-8859-5","windows-1251",$text_content);
$type_content=iconv("ISO-8859-5","windows-1251",$type_content);
echo "<br><b>question type: $type_content text: $text_content</b>";

$result_insert_question=mysql_db_query($mysql_dbname,"
insert into questions (question_id,topic_id,question_text,question_type,question_disable)
values ('',$topic_id,'$text_content','$type_content',0) ");

get_answers_from_xml($answers[0],mysql_insert_id());

    }

}

//---------------------------------------

function get_answers_from_xml($root,$question_id) {
global $mysql_dbname;

$answer_nodes=$root->get_elements_by_tagname('answer'); 
foreach($answer_nodes as $answer_node)
 {
$answer_text=$answer_node->get_elements_by_tagname('answer_text'); 
$answer_sample=$answer_node->get_elements_by_tagname('sample'); 
$answer_true=$answer_node->get_elements_by_tagname('true'); 

$text=$answer_text[0];$text_content=$text->get_content();
$sample=$answer_sample[0];$sample_content=$sample->get_content();
$true=$answer_true[0];$true_content=$true->get_content();
$text_content=iconv("ISO-8859-5","windows-1251",$text_content);
$sample_content=iconv("ISO-8859-5","windows-1251",$sample_content);
$true_content=iconv("ISO-8859-5","windows-1251",$true_content);

echo "answer text: $text_content sample: $sample_content true: $true_content<br>";

$result_insert_answer=mysql_db_query($mysql_dbname,"
insert into answers (answer_id,question_id,answer_text,answer_sample,answer_true)
VALUES ('',$question_id,'$text_content','$sample_content',$true_content)");

 }

}