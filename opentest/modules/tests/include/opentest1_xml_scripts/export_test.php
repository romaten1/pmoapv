<?
$test_id=$_GET[test_id];
//проверка, не пытаются ли нас хакнуть
if ( preg_match("/[^(\d)]/",$test_id)  ) {
	echo "пошёл нафиг, подлый хакер!";
	exit(); }


//проверка, если тест в базе
$result_check_test=mysql_db_query($mysql_dbname,"
select * from tests where test_id=$test_id ");
if(mysql_num_rows($result_check_test)==0) 
{echo $yaz['tstudio']['no_such_test'][$lang];
 exit();}


if($fetched_access[permission_owner]==1) {
$result_test=mysql_db_query($mysql_dbname,"select * from tests where test_id='$test_id'"); }
else {
$result_test=mysql_db_query($mysql_dbname,"
select permissions.*,tests.* from permissions,tests
where 	permissions.user_id='$_SESSION[user_id]' and 
	permissions.group_id='$_SESSION[group_id]' and
	permissions.object_code=1 and
	permissions.object_id=tests.test_id and
	tests.test_id='$test_id' and
	permissions.permission_owner=1
");


//проверка, есть ли у юзера доступ к этой зоне
if(mysql_num_rows($result_test)==0 and 
		$fetched_access[permission_owner]!=1 ) 
	{
	echo $yaz['tstudio']['zone_anavail'][$lang];
	exit();
	}
  }
//---- конец всех проверок

$fetched_test=mysql_fetch_array($result_test);

echo $yaz['tstudio']['xml_exporting_test'][$lang].": <br>
$fetched_test[test_name]";
require_once("./xml_scripts/export_xml_functions.php");

$res_export=export_xml("test",$test_id);

$xml_str=$res_export;
$xml_str=encode_xml_string($xml_str,"utf-8","windows-1251");
echo "<br>".$yaz['tstudio']['xml_file_size'][$lang].": $res_export B
	<br><font size=3 class='note'>".$yaz['tstudio']['xml_in_few_secs'][$lang]."</font>";
echo "<pre>".$xml_str."</pre>";

$download=1;